<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite System Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        h1 {
            color: #4a9eff;
        }
        .container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .panel {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .menu {
            width: 250px;
        }
        .display {
            flex: 1;
        }
        canvas {
            background: #000;
            border: 2px solid #444;
            border-radius: 4px;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
        .sprite-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }
        .sprite-item {
            padding: 8px 12px;
            margin: 4px 0;
            background: #333;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
        }
        .sprite-item:hover {
            background: #444;
        }
        .sprite-item.active {
            background: #4a9eff;
            color: #000;
        }
        .info {
            margin-top: 20px;
            padding: 15px;
            background: #333;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .controls {
            margin-top: 10px;
        }
        button {
            background: #4a9eff;
            color: #000;
            border: none;
            padding: 8px 16px;
            margin-right: 8px;
            cursor: pointer;
            border-radius: 4px;
            font-weight: bold;
        }
        button:hover {
            background: #6bb0ff;
        }
        button:disabled {
            background: #555;
            color: #888;
            cursor: not-allowed;
        }
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #4a9eff;
        }
        .error {
            color: #ff4a4a;
            padding: 20px;
            background: #3a1a1a;
            border-radius: 4px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ® Sprite System Example</h1>
    <p>Generic sprite handling system for Troup'O Invaders</p>

    <div id="loading" class="loading">
        Loading sprites...
    </div>

    <div id="error" class="error" style="display: none;"></div>

    <div id="app" class="container" style="display: none;">
        <div class="panel menu">
            <h3>Sprite Selection</h3>
            <ul id="sprite-list" class="sprite-list"></ul>
        </div>

        <div class="panel display">
            <h3>Display</h3>
            <canvas id="canvas" width="600" height="400"></canvas>
            
            <div class="controls">
                <button id="btn-play">Play Animation</button>
                <button id="btn-pause">Pause</button>
                <button id="btn-reset">Reset</button>
            </div>

            <div id="info" class="info"></div>
        </div>
    </div>

    <script type="module">
        import { spriteManager } from './src/js/sprites/SpriteManager.js';

        let canvas, ctx;
        let currentSprite = null;
        let currentAnimation = null;
        let lastTime = 0;
        let animating = false;

        async function init() {
            try {
                // Load sprites
                await spriteManager.load();
                
                // Hide loading, show app
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'flex';

                // Setup canvas
                canvas = document.getElementById('canvas');
                ctx = canvas.getContext('2d');

                // Populate sprite menu
                populateMenu();

                // Setup controls
                setupControls();

                // Start render loop
                requestAnimationFrame(animate);

                console.log('âœ“ Sprite system initialized');
            } catch (error) {
                showError(error.message);
            }
        }

        function populateMenu() {
            const list = document.getElementById('sprite-list');
            const sprites = spriteManager.getAllSpriteNames();

            sprites.forEach(spriteName => {
                const item = document.createElement('li');
                item.className = 'sprite-item';
                item.textContent = spriteName;
                item.onclick = () => selectSprite(spriteName);
                list.appendChild(item);
            });

            // Select first sprite by default
            if (sprites.length > 0) {
                selectSprite(sprites[0]);
            }
        }

        function selectSprite(spriteName) {
            // Update UI
            document.querySelectorAll('.sprite-item').forEach(item => {
                item.classList.toggle('active', item.textContent === spriteName);
            });

            // Create new animation
            currentSprite = spriteName;
            currentAnimation = spriteManager.createAnimation(spriteName);
            currentAnimation.play();
            animating = true;

            // Update info
            updateInfo();

            // Enable controls
            document.getElementById('btn-play').disabled = false;
            document.getElementById('btn-pause').disabled = false;
            document.getElementById('btn-reset').disabled = false;
        }

        function updateInfo() {
            if (!currentSprite) return;

            const info = spriteManager.getSpriteInfo(currentSprite);
            const infoDiv = document.getElementById('info');

            infoDiv.innerHTML = `
                <strong>Sprite:</strong> ${info.name}<br>
                <strong>Frames:</strong> ${info.frameCount}<br>
                <strong>FPS:</strong> ${info.fps}<br>
                <strong>Loop:</strong> ${info.loop}<br>
                <strong>Size:</strong> ${info.frameWidth}x${info.frameHeight}px<br>
                <strong>Spritesheet:</strong> ${info.spritesheet?.path || 'N/A'}<br>
                <strong>Current Frame:</strong> ${currentAnimation?.currentFrame || 0}
            `;
        }

        function setupControls() {
            document.getElementById('btn-play').onclick = () => {
                if (currentAnimation) {
                    currentAnimation.play();
                    animating = true;
                }
            };

            document.getElementById('btn-pause').onclick = () => {
                if (currentAnimation) {
                    currentAnimation.pause();
                    animating = false;
                }
            };

            document.getElementById('btn-reset').onclick = () => {
                if (currentAnimation) {
                    currentAnimation.reset();
                    currentAnimation.play();
                    animating = true;
                }
            };
        }

        function animate(timestamp) {
            requestAnimationFrame(animate);

            // Calculate delta time
            const deltaTime = lastTime ? timestamp - lastTime : 0;
            lastTime = timestamp;

            // Update animation
            if (currentAnimation && animating) {
                currentAnimation.update(deltaTime);
                updateInfo();
            }

            // Render
            render();
        }

        function render() {
            // Clear canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw current sprite
            if (currentAnimation) {
                // Center on canvas
                const x = canvas.width / 2 - 64;
                const y = canvas.height / 2 - 64;
                
                // Draw scaled up for visibility
                spriteManager.drawAnimation(ctx, currentAnimation, x, y, 128, 128);

                // Draw frame indicator
                ctx.fillStyle = '#4a9eff';
                ctx.font = '12px monospace';
                ctx.fillText(`Frame ${currentAnimation.currentFrame + 1}/${currentAnimation.frames.length}`, 10, 20);
            } else {
                // Show instruction text
                ctx.fillStyle = '#666';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Select a sprite from the menu', canvas.width / 2, canvas.height / 2);
                ctx.textAlign = 'left';
            }
        }

        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            document.getElementById('error').textContent = `Error: ${message}`;
        }

        // Start application
        init();
    </script>
</body>
</html>
